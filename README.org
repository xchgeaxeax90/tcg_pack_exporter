* Pack Creation Tool for Nyan's TCG
This program allows the user to:
 - Import a spreadsheet of card entries to create into a trading card pack
 - Downloads images for those cards
 - Displays a GUI to crop those cards to the correct dimensions
 - Generates a folder containing the cropped images and json metadata for a new trading card pack


** Creating a New Pack
Create a copy of or download this spreadsheet: https://docs.google.com/spreadsheets/d/1Vi_3anCozG1palF7mx17x5o_0OgBupKX6wqIRjM615A/edit?usp=sharing

The spreadsheet contains 3 sheets:
 - Cards - Add individual cards to this table
 - Character Groups - Create bundles that accept any card (common/rare/specialrare) of specific characters
 - Card Groups - Create bundles that only accept specific cards

Additional sheets can be added, for taking notes, computing
statistics, whatever, but these 3 sheets and their column structure
must not be removed or altered.

*** Creating Cards

Each entry in the cards sheet must contain data in the following columns
 - Name - The name of the character. This will appear on the card's top text box
 - Variant - The variant of the card, such as "Bunnygirl", "Wine",
   "Cheeky", or blank if the card does not have a variant. If this
   field is not blank, the variant will be appended to the top text
   box in parenthesis (i.e. setting this to "Cheeky" will create "Character Name (Cheeky)" for the card textbox)
 - Company - The company the character is associated with, or "Indie
   VTuber" if the person is independent. This will appear in the
   bottom left text box on the card
 - Rarity - Must be one of "Common", "Rare", or "Special Rare"
 - Credit - The twitter handle, pixiv username, or other social media
   info for the artist that created the card image. Can be blank
 - Source URL - The URL to be displayed to the user as an image
   credit. Should point to a tweet or a webpage if possible
 - File URI - The URI or URL of the actual image file. For images
   found online, this should be the url of the actual file, not the
   url of a tweet or webpage. For files stored locally, this should be
   the path to the file prefixed with 'file:' for relative paths or
   'file://' for absolute paths
 - Notes - Ignored by the tool, space for any notes you might want to
   have on the image
 - Group - Set to 1 or TRUE if the card contains multiple characters
   (i.e. Pomu & Finana). This will disable the character field for
   this card so it doesn't count for character packs

Some examples are shown in the template already. However, if I were to want to add the following tweet as a card
https://x.com/Sai_Ca5/status/1654690810800279554?s=20

I would enter it like so:
| Name    | Variant | Company       | Rarity | Credit   | Source URL                                       | FILE URI                                                              | Notes | Group |
|---------+---------+---------------+--------+----------+--------------------------------------------------+-----------------------------------------------------------------------+-------+-------|
| Sennzai | VTTRACT | Indie VSinger | Rare   | @Sai_Ca5 | https://x.com/Sai_Ca5/status/1654690810800279554 | https://pbs.twimg.com/media/FvakLWMaAAAcB5d?format=jpg&name=4096x4096 |       |       |

To obtain the URL I opened the tweet, right clicked and clicked "Copy
Image Link". Specifically, URLs such as
https://x.com/Sai_Ca5/status/1654690810800279554/photo/1 will not
work as a File URI, the URL must link directly to the image file.

*** Creating Bundles

Bundles are created by entering mappings between cards or characters
and the bundle name in the "Card Groups" or "Character Groups" sheets
in the spreadsheet.

The "Character Groups" sheet creates bundles that will match any card
containing specific characters. For instance, the template defines one
bundle "Lazulight" which will match any cards in the pack for:
 - Pomu Rainpuff
 - Finana Ryugu
 - Elira Pendora

The "Card Groups" sheet creates bundles that only match specific cards
in the pack. For instance, the template defines a bundle named "Tummy
and Toof" that will match the cards:
 - Pomu Rainpuff (Toof)
 - Finana Ryugu (Tummy)

But will not match other cards for Pomu or Finana.
   
** Exporting a Card Pack

This section assumes the user knows how to install and run python
programs, as well as use git. It is not intended as a general purpose walkthrough.

This program uses poetry, which can be installed from here: https://python-poetry.org/docs/#installation

*** Download and Setup

Run:

#+BEGIN_SRC console
  git clone https://github.com/xchgeaxeax90/tcg_pack_exporter.git
  cd tcg_pack_exporter
  poetry install
#+END_SRC

*** Running

To export a pack, run the tool by passing in the path to the
spreadsheet containing the pack's data (either .xlsx or .ods format),
a directory to export the pack data to, and the pack name:
#+BEGIN_SRC console
  poetry run python main.py path/to/spreadsheet.xlsx export/my_bundle "My Pack"
#+END_SRC

**** Cropping
The tool should download the images from the URLs in the spreadsheet,
then open a GUI to allow you to crop the images to the dimensions
required by the TCG bot.

[[./documentation/crop_gui.png]]

The GUI should look like the above photo, with an image from the
spreadsheet shown in the center, and 3 buttons at the bottom.

Clicking and dragging on the image will display two rectangles, blue
and red. The red rectangle represents the region of the image that
will be cropped to the 550x750 dimensions required by Nyan's TCG
bot. The blue region represents what will actually be visible on the
card front, when the card border and name textbox are added. The mouse
controls the position of the blue visible rectangle, while the red
crop rectangle is dynamically sized relative to the blue
rectangle. Note that while the blue rectangle should not go outside
the bounds of the image, the red crop rectangle can. 

[[./documentation/sennzai_crop.png]]
For instance, when cropping the image of Sennzai above, I selected a
region that places the blue visible area region very close to the
borders of the image, such that the red crop rectangle ends up outside
the border of the image. This results in an exported image that looks
like this:

[[./documentation/sennzai_export.png]]

Notice that the top of the image is black/transparent, since the
boundary of the red crop rectangle extended outside of the bounds of
the image. This region will be covered up by the nameplate, so it
should not be an issue.

*** Previews
This tool has the ability to generate previews of what the trading
cards might look like when imported into nyan's bot. The previews are
not intended to look exactly like the cards in game, but to make sure
that the visible area of the card looks ok. Thus things like shading,
colors, image radii, antialiasing are all wrong, however the position
and size of the image border and text boxes should be correct to +/- 1
pixel.

Previews of what the generated cards will look like are generated in
the =export/my_bundle/previews= directory when the =-p= or =--preview=
flag is passed to the tool, like so:

#+BEGIN_SRC console
  poetry run python main.py path/to/spreadsheet.xlsx export/my_bundle "My Pack" --preview
#+END_SRC

For example, the generated preview of the above image looks like this:

[[./documentation/sennzai_preview.png]]

Note that the black area at the top of the image is covered up by the
top nameplate.

*** Data Export

After running, the tool should create a json file at
=export/my_bundle/pack_data.json= containing the card and bundle data
for the pack. It will also create a directory
=export/my_bundle/images= containing the cropped and resized images
for the card fronts. This file and this directory should be all that
is required to import the data into nyan's discord bot.
